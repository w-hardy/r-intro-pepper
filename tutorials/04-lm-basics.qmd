---
title: "Linear models: a minimal example"
---

Linear models describe how a numeric response changes with one or more predictors.  
In this chapter you will:

1. Fit a linear model with `lm()`
2. Tidy coefficient estimates for interpretation
3. Check model diagnostics and make predictions

:::{.callout-note}
This section assumes:

* you have loaded `dplyr`, `ggplot2`, and `broom`
* your response variable is numeric and roughly continuous
* you have inspected the data for missing values or obvious entry errors
:::

We continue using the `penguins` dataset to predict bill length.

```{r}
#| message: false
library(dplyr)   # Data manipulation
library(ggplot2) # Visualisation
library(broom)   # Model tidying

penguins |>
  select(species, bill_len, bill_dep, flipper_len, body_mass, sex) |>
  head()
```

---

## Fit a linear model

Use `lm()` with a formula of the form `response ~ predictor1 + predictor2` to estimate how a numeric outcome changes with one or more predictors.  
For example, we can model penguin bill length as a function of bill depth.

::: {.panel-tabset}

### Example

```{r}
fit_simple <- lm(bill_len ~ bill_dep, data = penguins)
fit_simple
```

This output gives the intercept and slope estimates for the linear relationship between `bill_len` and `bill_dep`.

### Exercise

Extend the model to also include `species` as a categorical predictor. Replace the blanks with the appropriate code.

```{r}
#| eval: false

fit_species <- lm(bill_len ~ bill_dep + ____, data = ____)
fit_species
```

:::{.callout-tip}
`lm()` automatically creates indicator variables for factors such as `species`.
:::

### Solution

```{r}
#| code-fold: true
#| code-summary: "Show solution"

fit_species <- lm(bill_len ~ bill_dep + species, data = penguins)
fit_species
```

:::

---

## Interpret coefficients

`broom::tidy()` converts model output into a tidy tibble that is easy to read and combine with other results.  
Each coefficient represents the expected change in bill length for a one-unit change in that predictor, holding all others constant.

::: {.panel-tabset}

### Example

Obtain coefficient estimates with standard errors and p-values.

```{r}
tidy(fit_species)
```

### Exercise

Add 95% confidence intervals to the tidy output. Replace the blanks with the correct argument names.

```{r}
#| eval: false

tidy(fit_species, conf.int = ____, conf.level = ____)
```

:::{.callout-note}
Confidence intervals show a range of plausible values for each coefficient.
:::

### Solution

```{r}
#| code-fold: true
#| code-summary: "Show solution"

tidy(fit_species, conf.int = TRUE, conf.level = 0.95)
```

:::

---

## Check diagnostics and predict

Use `augment()` for row-level diagnostics and `glance()` for overall model fit.  
Residuals should scatter randomly around zero; systematic patterns may indicate model misspecification.  
Predictions require a tibble of new values using the same variable names as in the model.

::: {.panel-tabset}

### Example

We first examine model diagnostics.

```{r}
augmented <- augment(fit_species)

ggplot(augmented, aes(x = .fitted, y = .resid, colour = species)) +
  geom_point() +
  geom_hline(yintercept = 0, linewidth = 0.3) +
  labs(x = "Fitted bill length", y = "Residuals") +
  theme_minimal()
```

Summarise overall model fit.

```{r}
glance(fit_species)
```

We can also use `predict()` to generate fitted values for the training data or new data.  
Here we predict bill length for the first three penguins in the dataset.

```{r}
predict(fit_species, newdata = penguins |> head(3))
```

`predict()` returns a numeric vector of fitted values corresponding to the supplied rows.

### Exercise

Create predicted bill lengths for new penguins with specified bill depth and species.  
Replace the blanks with the correct column names or objects.

```{r}
#| eval: false

# tibble() creates a small data frame of new values
new_penguins <- tibble(
  bill_dep = c(17, 19),
  species = c("Adelie", "Gentoo")
)

pred <- predict(____, newdata = ____)

new_penguins |>
  mutate(predicted_bill_len = ____)
```

:::{.callout-warning}
Always check that your new data use the same variable names and factor levels as the original training data.
:::

### Solution

```{r}
#| code-fold: true
#| code-summary: "Show solution"

new_penguins <- tibble(
  bill_dep = c(17, 19),
  species = c("Adelie", "Gentoo")
)

pred <- predict(fit_species, newdata = new_penguins)

new_penguins |>
  mutate(predicted_bill_len = pred)
```

:::

---

## Next steps

You now know how to:

* fit a linear model with `lm()`
* interpret coefficients using `broom::tidy()`
* check assumptions with `augment()` and `glance()`
* generate predictions with `predict()`

Next, experiment with interaction terms (e.g., `bill_dep * species`) or try using another numeric response such as `body_mass`.
